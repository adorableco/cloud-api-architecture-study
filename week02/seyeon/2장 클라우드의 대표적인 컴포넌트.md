# 2. 클라우드의 대표적인 컴포넌트

## 📖 2.1 클라우드 환경의 전체 그림

## 1.1 테넌트
클라우드 서비스 이용자는 자신만의 테넌트 환경을 갖게됨

> AWS에서는 AWS계정이 테넌트

- 여러 서비스 이용자가 하나의 테넌트 공용 사용 가능

> #### 🙋‍♀️ 질문1
> 그럼 하나의 계정으로 IAM 역할을 나누어 여러 사람이 사용하면 하나의 테넌트를 사용하는 것이고 AWS Organization 에서 여러 멤버 계정을 관리하면 여러 테넌트를 각각이 사용하는 것인가?

--

## 1.2 리전
- 각 리전들은 서로 독립된 환경
    - 리전별로 가상 네트워크 구성 가능
    - 여러 리전에 걸친 가상 네트워크는 못만듦
    - 사용자 계정이나 테넌트 정보는 여러 리전에 걸쳐서 사용 가능

> 오브젝트 스토리지는 모든 리전에서 공통으로 사용할 수 있도록 만들어짐
> - 데이터를 다른 리전으로 복제할 때 사용

> #### 🙋‍♀️ 질문2
> 재해복구를 위해 데이터를 다른 리전으로 복제하는 경우에는 더 먼 리전을 선택해야할 더 가까운 리전을 선택해야할까?

---

## 1.3 가용영역
하나의 리전을 구성하는 클라우드 인프라가 실제로는 해당 지역의 여러 데이터 센터에 분산돼 있음 ➡️ 이를 `AZ(Availability Zone)` 이라고 함

> #### ✨ 중요
> 각각 다른 AZ에 있는 가상 머신 인스턴스와 블록 스토리지는 서로 연결 불가

- AWS에서는 `서브넷`(가상 스위치 컴포넌트)을 가용 영역별로 구성할 수 있음
- 오픈스택에서는 가상 네트워크가 여러 가용 영역에 걸쳐 구성될 수 있음
    - 즉, 같은 가상 스위치에 접속돼있다면 어느 가용 영역에 있더라도 논리적으로는 같은 네트워크 스위치에 연결된 것처럼 동작함

### 오픈스택에서 가용 영역을 어떤 단위로 구성할지
#### 1. 데이터 센터 단위
- 여러 가용 영역에 걸쳐 더 큰 범위로 구성 가능
- **문제점** : 데이터 센터 사이의 네트워크 데역이 충분하지 않으면 원하는 통신 속도가 나오지 않을 수 있음

#### 2. 데이터 센터보다 더 작은 단위
- 같은 데이터 센터 내에서 서로 다른 플로어나 랙과 같이 더 작은 단위로 가용 영역 구성
- 특정 플로어에서 전원 문제가 발생해도 다른 플로어의 웹서버가 기동 중이기 때문에 서비스 자체의 중단을 면할 수 있음

> #### 🙋‍♀️ 질문3
> 데이터 센터 단위의 가용 영역은 한 플로어에서 문제가 발생해도 아예 다른 가용영역의 백업을 사용하나?

---
## 📖 2.2 네트워크 리소스

> - AWS : 하나의 리전에 여러 개의 VPC를 둘 수 있음
> - 오픈스택 : 테넌트 별로 하나의 리전에 단 하나의 가상 네트워크만 둘 수 있음

## 2.1 라우터
- 테넌트 안의 가상 네트워크와 물리적인 외부 네트워크를 연결하기 위해 필요함
- 기본적으로 가상 네트워크 하나당 하나의 가상 라우터가 배치됨
- 가상네트워크에서 외부 네트워크와 통신할 때 가상 라우터의 `NAT` 기능을 사용해서 퍼블릭IP로 변환함

---

## 2.2 스위치(서브넷)
- 가상 라우터와 가상 머신 인스턴스의 가상 NIC가 연결되는 접점
- **하나의 가상 스위치에 하나의 서브넷이 할당됨**
> #### 서브넷 (Subnet)
> 가상 머신 인스턴스가 사용할 수 있는 사설 IP주소의 범위

- AWS에서는 가상 스위치 개념은 없고 서브넷 개념만 사용!
- AWS : 가용 영역마다 가상 스위치가 배치됨
- 오픈스택 : 리전에 있는 여러 가용 영역에 걸쳐 가상 스위치가 배치됨

> #### 🙋‍♀️ 질문4 이게 뭔소린가... (65p.)
> 물리적인 네트워크 환경에서는 네트워크 스위치의 접속 포트가 부족할 때 여러 개의 네트워크 스위치를 연쇄적으로 연결하여 포트 개수를 늘리기도 합니다. 하지만 클라 우드 환경의 가상 스위치는 물리적인 스위치 장비처럼 여러 개를 연결하지 않아도 됩니다. 가상 스위치는 논리적으로 접속 포트 개수를 얼마든지 늘릴 수 있기 때문입니다.

---

### 2.3 공인IP 주소
가상네트워크에서 외부와 통신할 때는 가상 라우터의 NAT 기능을 사용하여 사설IP ➡️ 공인IP로 변환

### IP 마스커레이딩 (IP Masquerading)
- 가상 머신 인스턴스가 외부 네트워크로 접속할 때 가상 라우터가 할당 받은 공인 IP를 공유하는 방식
- 가상 ➡️ 외부 네트워크 방향 : 가능
- 외부 ➡️ 가상 머신 인스턴스 방향 : 불가능
    - 당연함 어떤 가상 머신 인스턴스이든 같은 IP주소로 통일 돼있기 때문에 누가누군지 모름

### 엘라스틱 IP (AWS) , 플로팅 IP (오픈스택)
- 미리 개별적으로 확보해 둔 공인 IP 주소를 가상 머신 인스턴스에 할당하는 방식
    - 이는 `가상 라우터`가 공인IP ➡️ 사설IP로 변환해줌
- **각 테넌트마다 엘라스틱 IP나 플로팅 IP로 사용할 수 있는 공인 IP 주소를 사전에 확보해둠**
- 가상 ➡️ 외부 네트워크 방향 : 가능
- 외부 ➡️ 가상 머신 인스턴스 방향 : 가능

> #### ✨ 중요
> 이는 리전마다 따로 확보해야 해서 한 리전에서 확보한 IP를 다른 리전에선 사용못함

## 2.4 시큐리티 그룹
가상 머신 인스턴스가 주고 받을 네트워크 패킷에 대해 **필터링 기능**을 제공함
- 필터링 처리는 가상 머신 인스턴스와 가상 스위치의 **접속 포트 사이**에서 이루어짐

---
## 📖 2.3 서버 리소스

## 3.1 템플릿 이미지
가상 머신 인스턴스를 기동하려면 게스트OS가 설치된 기동 디스크가 필요한데 이를 만들 때 사용하는 것이 템플릿 이미지
- 선택된 이미지는 다운로드되어 가상 디스크 형태로 만들어지고 가상 머신 인스턴스가 이 가상 디스크를 연결하여 사용함

> #### 🧐 조사 : 게스트OS가 무엇인가
> 가상머신(VM) 내부에서 실행되는 운영체제입니다. 호스트 OS 위에서 가상화된 하드웨어 환경을 통해 동작하며, 마치 독립된 컴퓨터에서 실행되는 것처럼 작동합니다.

---

## 3.2 인스턴스 유형
가상 머신의 컴퓨팅 성능 및 용량을 결정함
- `AWS` : 사용자가 세로운 인스턴스 유형을 만들지는 못함
- `오픈스택` : 테넌트의 관리 권한이 있는 사용자라면 새 인스턴스 유형을 직접 만들거나 변경 가능

### 이페머럴(Ephemeral) 디스크
가상 머신 인스턴스를 종료하거나 파괴하면 이들 디스크 영역의 데이터도 함께 사라짐
- `루트 디스크` : 템플릿 이미지를 복제해서 만들어진 기동 디스크
- `임시 디스크` : 아직 사용하지 않은 디스크 디바이스

> 영속적으로 보존해야하는 데이터는 별도의 `블록 스토리지` or `오브젝트 스토리지` 사용

---
## 3.3 네트워크 접속과 시큐리티 그룹

