# 2. 클라우드의 대표적인 컴포넌트

## 2.1 클라우드 환경의 전체 그림

### 테넌트
> 클라우드 서비스 제공자의 리소스를 사용하는 주체   
`AWS` AWS 계정
- 같은 테넌트 내 가상 네트워크, 가상 머신 인스턴스, 가상 스토리지 서로 연결 가능
- 대부분의 경우, 프로젝트 한 팀이 하나의 테넌트를 만들고 그 안에 애플리케이션 시스템들을 모아 넣는 것이 일반적   
네트워크 세그먼트를 분할을 위해 가상 네트워크 기능을 사용해서 애플리케이션 시스템마다 독립된 네트워크 환경을 갖도록 함

### 리전
> `AWS` 클라우드 인프라가 분산 운용되고 있는 지역  
- 사용자와 지리적으로 가까운 리전에 시스템을 구축하는 것이 유리
- 각 리전은 독립된 환경이므로 여러 리전에 걸친 가상 네트워크는 만들 수 없음
- 사용자 계정/테넌트 정보는 리전별로 관리되는 것이 아니어서 여러 리전에 걸쳐 사용할 수 있음   
(ex. Disaster Recovery 환경)
> `오픈스택` 사설 클라우드 구축 시, 여러 나라의 각 지역 단위로 서로 다른 리전을 구성 / 국내 데이터 센터 단위로 리전을 구성

### 가용영억
> `AWS` 리전을 구성하는 클라우드 인프라의 데이터 센터   
- 가용 영역 별로 서브넷(가상 스위치 컴포넌트) 구성
- VM 인스턴스 샐행 또는 블록 스토리지 볼륨 생성 시 해당 컴포넌트가 위치할 가용 영역을 선택할 수 있음
- 다른 가용 영역에 있는 VM 인스턴스와 블록 스토리지는 서로 연결할 수 없음

> `오픈스택` 데이터 센터 / 같은 데이터 센터에서 서로 다른 플로어(floor) 또는 랙(rack)과 같은 작은 단위
- 여러 가용 영역에 걸처 넓은 범위로 가상 네트워크가 구성될 수 있음
- 어느 가용 영역에 있더라도 논리적으로 같은 네트워크 스위치에 연결된 것 처럼 동작

**데이터 센터**
- 원하는 통신 속도를 위해서는 데이터 센터 사이의 네트워크 대역에 주의 필요
- 서로 다른 데이터 센터 간 통신을 해야 하는 상황은 데이터 센터 간 거리로 인해 전송 속도 측면에서 불리하므로 이런 구성에서는 서로 다른 가용 영역 간의 연결은 정책적으로 허용하지 않는 것이 바람직

**플로어/랙**
- 여러 대의 웹 서버를 여러 가용 영역에 나눠 운영하는 경우, 특정 가용 영역의 서버가 중지되어도 서비스 자체가 중단되는 상황을 피할 수 있음

## 2.2 네트워크 리소스

### 라우터
> 테넌트 안의 가상 네트워크와 물리적인 외부 네트워크를 연결하기 위해 가상 라우터가 필요

**가상 네트워크**
- 가상 네트워크는 리전별로 독립된 형태, 독립된 가상 네트워크는 외부의 접근이 제한된 사설 네트워크
가본적으로 가상 네트워크 하나당 하나의 가상 라우터 배치
- `AWS` 가상 사설 클라우드(Virtual Private Cloud), 하나의 리전에 여러 VPC 가능
- `오픈 스택` 테넌트 별로 하나의 리전에 하나의 가상 네트워크만 가능
- 프라이빗/사설 IP 주소 사용   
외부 네트워크와 통신할 대는 가상 라우터의 NAT(Network Address Translation) 기능을 사용해 퍼블릭/공인 IP로 변환

### 스위치(서브넷)
> 가상 라우터와 VM 인스턴스의 가상 NIC(Network Interface Card)가 연결되는 접점
- 하나의 가상 스위치에 하나의 서브넷 할당   
서브넷: VM 인스턴스가 사용할 수 있는 사설 IP 주소의 범위
- `AWS` 가상 스위치 = 서브넷   
하나의 가상 스위치(서브넷)가 하나의 가용 영역에 배치
- `오픈 스택` 가상 스위치를 정한 후 서브넷 할당   
하나의 가상 스위치가 여러 개의 가용 영역에 걸쳐 사용 가능
- 가상 스위치 정의 후 가상 라우터와 연결 시 외부 네트워크와 통신 가능   
or 가상 라우터와 연결하지 않고 가상 네트워크 범위 안에서만 통신 가능
- 가상 스위치는 논리적으로 접속 포트 개수를 얼마든지 늘릴 수 있음
- 가상 스위치 포트 구성 과정   
가상 스위치 정의 → 접속 포트 추가(서브넷 범위 내 사용 가능한 IP 주소 명시적/자동 할당) → 가상 인스턴스의 NIC 연결(DHCP 방식)   
*DHCP(Dynamic Host Configuration Protocol)   
: 네트워크에 연결된 장치(PC, 스마트폰, 서버 등)에 자동으로 IP 주소, 서브넷 마스크, 게이트웨이, DNS 서버 주소 등을 할당해주는 프로토콜

### 공인 IP 주소
> 외부에서 접근 가능 한 인터넷에에서 고유하게 식별되는 IP 주소
- 외부와의 통신을 위해 가상 라우터의 NAT 기능을 사용하여 사설 IP를 공인 IP로 변환   
두 가지 변환 방법: IP 마스커레이딩(IP Masquerading), `AWS` 엘라스틱 IP(Elastic IP)/`오픈 스택` 플로팅 IP(Floating IP)
- VM 인스턴스의 게스트 OS에 할당된 사설 IP 주소를 가상 라우터가 공인 IP 주소로 1:1 변환   
VM 인스턴스에 공인 IP 주소를 할당하는 것이 게스트 OS에 공인 IP 주소가 직접 할당되는 것이 아님

**IP 마스커레이딩(IP Masquerading)**
- VM 인스턴스가 외부 네트워크로 접속할 때 가상 라우터가 할당 받은 공인 IP를 공유하는 방식
- 동일한 공인 IP 주소를 여러 개의 사설 IP 주소에 매핑
- 내부에서 외부로 나가는 접속은 가능하지만 외부 네트워크에서 VM 인스턴스로 들어오는 접속은 허용되지 않음

**`AWS` 엘라스틱 IP(Elastic IP)/`오픈 스택` 플로팅 IP(Floating IP)**
- 미리 개별적으로 확보해 둔 공인 IP 주소를 VM 인스턴스에 할당하는 방식
- 내부에서 외부로 나가는 통신과 외부에서 내부로 들어오는 통신 모두 가능
- 리전마다 따로 IP를 확보해야 함

### 시큐리티 그룹
> VM 인스턴스가 주고 받을 네트워크 패킷에 대해 필터링 기능을 제공하는 역할
- 통신을 허용할 패킷의 조건을 미리 정의하고 이 규칙을 VM 인스턴스에 적용하는 방식, 여러 VM 인스턴스에 중복 적용 가능
- VM 인스턴스와 가상 스위치의 접속 포트 사이에서 필터링 처리가 이루어짐
- VM 인스턴스가 기동된 상태에서도 이미 적용된 시큐리티 그룹을 교체하거나 설정 내용을 재정의하는 것도 가능

## 2.3 서버 리소스

### 템플릿 이미지
> VM 인스턴스 기동을 위해서는 기동 디스크가 필요하고 기동 디스크를 만들 때 템플릿 이미지를 사용   
> *기동 디스크: 게스트 OS가 설치된 디스크로, VM이 부팅될 때 이 디스크를 읽어 운영체제를 실행
- 다운로드 된 템플릿 이미지가 가상 디스크 형태로 만들어지고 VM 인스턴스가 연결하여 사용
- 클라우드 서비스 제공자가 미리 준비해둔 것 또는 클라우드 서비스 이용자가 직접 만든 것을 활용

### 인스턴스 유형
> 가상 머신의 컴퓨팅 성능 및 용량을 결정하며 각 타입별로 가상 CPU의 개수나 가상 메모리의 용량, 가상 디스크의 용량 등이 정해져 있음
- `AWS` 사용자가 새로운 인스턴스 유형을 사용자 정의로 직접 만들 수 없음
- `오픈 스택` 테넌트 관리 권한이 있는 사용자의 경우 인스턴스 유형을 직접 만들거나 수정할 수 있음   
설정 가능한 인스턴스 유형 항목: 가상 CPU, 메모리, 루트 디스크, 임시 디스크, 스왑 디스크   
*루트 디스크: 템플릿 이미지를 복제해서 만들어진 기동 디스크   
*임시 디스크: 아직 사용하지 않은 디스크 디바이스
    - 이페머럴(Ephemeral) 디스크: VM 인스턴스를 종료하거나 파괴하면 데이터가 함께 사라지는 디스크(재부팅하는 경우에는 데이터가 유지됨)   
    → 루트 디스크, 임시 디스크
    - 영구적으로 보존해야 하는 데이터는 별도의 '블록 스토리지' 또는 '오프젝트 스토리지'에 보존
- VM 인스턴스 기동 후 루트 디스크 영역에 작업된 내용을 보존하고 싶다면 VM 인스턴스의 스냅샷 활용
- 게스트 OS를 기동할 때 템플릿 이미지가 아닌 블록 스토리지를 루트 디스크로 활용할 수도 있음   
→ 데이터 재사용 가능

### 네트워크 접속과 시큐리티 그룹
> VM 인스턴스의 가상 NIC가 네트워크에 연결되려면 가상 스위치와 연결되어야 하고 시큐리티 그룹이 설정되어야 함
- 여러 개의 가상 스위치에 연결하고 싶다면 각 가상 스위치별로 가상 NIC도 여러개 준비되어야 함
- 가상 스위치의 접속 포트에 특정 IP 주소가 할당되어 있어서 가상 NIC가 연결될 때 해당 IP 주소를 사용
- 여러 개의 가상 NIC가 있다면 각각 서로 다른 시큐리티 그룹을 적용할 수 있음

### 로그인 인증과 키 페어
> VM 인스턴스의 게스트 OS에 로그인할 때 사용자 인증이 필요하고, 이때 기본적으로 SSH 공개 키 인증 방식이 사용됨   
> *SSH(Secure Shell): 원격 컴퓨터에 안전하게 접속하기 위한 암호화된 통신 프로토콜
- 전용 키 페어(공개 키, 개인 키)를 만들고 클라이언트가 VM 인스턴스에 SSH로 접속할 때 마다 미리 설정된 공개 키에 대응하는 개인 키를 사용
- 게스트 OS 내의 'Cloud-init' 툴에서 인증 관련 설정 처리가 이루어지며, 미리 설치해두어야 함
- Cloud-init은 게스트 OS가 처음 기동될 때 지정된 공개 키를 받아 SSH의 인증 정보를 설정하는 역할

## 2.4 블록 스토리지 리소스
가상 머신 인스턴스가 종료되거나 파괴되어도 내용을 보존할 수 있도록 영속적인 디스크 영역을 제공
`AWS` EBS(Elastic Block Store) / `오픈 스택` 블록 스토리지

### 블록 스토리지의 기본 기능
- 신규 블록 볼륨 생성(용량 지정)
- 가상 머신 인스턴스에 연결, 데이터 영역으로 사용
- 스냅샷 생성, 복제 후 새로운 블록 볼륨 생성
- 기존의 블록 볼륨을 다른 가상 머신 인스턴스에 연결해서 재사용 가능

### 블록 스토리지에서 가상 머신 인스턴스 기동하기
> 템플릿 이미지가 아닌 블록 스토리지의 볼륨에 있는 게스트 OS로 VM 인스턴스를 기동할 수 있음   
> `AWS` EBS Boot / `오픈 스택` Boot form Volume
- VM 인스턴스를 기동할 대 제공되는 템플릿 이미지 대신, 미리 템플릿 이미지를 복제한 볼륨을 지정
- VM 인스턴스를 종료하더라도 OS 영역의 데이터가 삭제되지 않음   
→ 해당 볼륨으로 또 다른 VM 인스턴스를 기동하면 종료 직전의 구성으로 설정된 게스트 OS를 재사용할 수 있음

## 2.5 오브젝트 스토리지 리소스
파일 단위로 데이터를 저장하는 데이터 스토어, HTTP/HTTPS 프로토콜을 사용하는 파일 서버

### 오브젝트 스토리지의 기본 기능
> 파일 단위로 데이터를 저장하는 기능 제공   
> 오프젝트를 담는 것: `AWS` 버킷, `오픈 스택` 컨테이너
- 파일을 다루는 기능은 단순한 반면, 가용성이 높고 처리율이 우수하여 동영상과 같은 정적 콘텐츠 파일을 저장하기에 적합함
- 오브젝트 스토리지는 장소나 지역에 상관없이 인터넷을 통해 접속할 수 있음 → HTTP/HTTPS 프로토콜을 사용하기 때문   
(다른 리전의 VM 인스턴스에서 생성한 파일을 사용할 수 있음)
- 파일 저장을 위해서 오브젝트를 담을 수 있는 컨테이너 생성, 계층구조는 지원하지 않지만 가상의 디렉터리명을 붙여 파일명 수식 가능
- key, value 형식의 메타 데이터를 활용하면 파일 선별에 용이함

### 버저닝과 정적 웹 호스팅
> 버저닝: 컨테이너에 저장된 오브젝트에 버전 번호를 붙여 관리하는 기능   
- 오브젝트 스토리지에 같은 이름의 파일을 저장하면 새로운 버전 번호로 파일이 저장됨
- 기존 파일이 그대로 남아 버전 번호를 지정하면 이전 파일의 내용 복원 가능

> 정적 웹 호스팅: 오브젝트 스토리지를 간이 웹 서버처럼 사용하는 기능
- 컨테이너 접근 권한을 공용으로 설정하고 정적 HTML 파일을 저장, 해당 오브젝트에 할당된 URL 주소로 접근
- 이미지 파일, 동영상 파일 등을 저장하고 HTTP/HTTPS를 사용하는 클라이언트에서 해당 파일을 표시 및 재생 가능

### 오브젝트 스토리지의 백업
> 오브젝트 스토리지는 블록 스토리지의 볼륨을 백업하는 용도로 사용할 수 있음
- 블록 스토리지의 볼륨을 일정 크기의 블록으로 분할한 뒤 각 조각들을 하나의 파일 형태로 오브젝트 스토리지에 저장하는 방식
- 오브젝트 스토리지는 지리적 제약 없이 접근 가능하므로 백업 후 다른 리전에서 접근할 수 있어 저장된 백업 볼륨을 이용해 복원할 수 있음

## 2.6 웹 애플리케이션 시크템의 구축 예

### 여러 개의 가용 영역으로 가용성 확보하기

### 오브젝트 스토리지를 사용하여 데이터 보호하기
